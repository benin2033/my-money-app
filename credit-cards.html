<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>ä¿¡ç”¨å¡ç®¡ç†</title>
  <style>
    :root {
      --bg: #f7efe2;
      --card: #fffaf4;
      --line: #e5d7c8;
      --text: #46362d;
      --subtle: #7a6357;
      --accent: #b57542;
      --accent-deep: #975d33;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", sans-serif;
      color: var(--text);
      background: var(--bg);
      padding: 16px;
    }
    .wrap {
      width: 100%;
      max-width: 820px;
      margin: 0 auto;
      display: grid;
      gap: 12px;
    }
    .card {
      border: 1px solid var(--line);
      border-radius: 14px;
      background: var(--card);
      padding: 14px;
      display: grid;
      gap: 10px;
    }
    h1 { margin: 0; font-size: 1.15rem; }
    p { margin: 0; color: var(--subtle); font-size: 0.9rem; }
    .grid {
      display: grid;
      gap: 8px;
      grid-template-columns: 1.2fr 1fr auto;
    }
    input, select, button, a {
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 10px 12px;
      min-height: 44px;
      font-size: 0.92rem;
      color: var(--text);
      background: #fff9f2;
      text-decoration: none;
    }
    button { cursor: pointer; }
    .btn-primary {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff8f0;
    }
    .btn-primary:hover {
      background: var(--accent-deep);
      border-color: var(--accent-deep);
    }
    .list { display: grid; gap: 8px; }
    .row {
      border: 1px solid var(--line);
      border-radius: 10px;
      background: #fffdf9;
      padding: 10px;
      display: flex;
      justify-content: space-between;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }
    .meta { color: var(--subtle); font-size: 0.82rem; }
    .head { display: flex; justify-content: space-between; gap: 8px; align-items: center; flex-wrap: wrap; }
    .row-actions { display: inline-flex; gap: 6px; }
    .tiny-btn { font-size: 0.8rem; padding: 6px 8px; }
    .robot-btn {
      position: fixed;
      right: 18px;
      bottom: 18px;
      width: 62px;
      height: 62px;
      border-radius: 50%;
      border: 1px solid #e3c2a3;
      background: linear-gradient(145deg, #f6dec1, #f0c899);
      box-shadow: 0 8px 18px rgba(129, 81, 46, 0.25);
      font-size: 1.5rem;
      z-index: 30;
    }
    .robot-panel {
      position: fixed;
      right: 18px;
      bottom: 92px;
      width: min(360px, calc(100vw - 24px));
      border: 1px solid var(--line);
      border-radius: 16px;
      background: #fff8ef;
      box-shadow: 0 10px 24px rgba(92, 57, 34, 0.12);
      padding: 12px;
      z-index: 30;
      display: none;
    }
    .robot-panel.show { display: block; }
    .tool-title { margin: 0 0 8px; color: #6f4d3a; font-size: 0.93rem; font-weight: 700; }
    .tool-list { margin: 0 0 10px; padding-left: 18px; color: var(--subtle); font-size: 0.86rem; line-height: 1.55; }
    .calc { border: 1px solid var(--line); border-radius: 12px; padding: 10px; background: #fbf1e3; }
    .calc-screen { width: 100%; margin-bottom: 8px; text-align: right; font-weight: 700; font-size: 1rem; background: #fff8f0; }
    .calc-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; }
    .calc-grid button { padding: 9px 0; font-weight: 700; }
    @media (max-width: 520px) {
      body { padding: 10px; }
      .grid { grid-template-columns: 1fr; }
      .robot-btn { width: 54px; height: 54px; right: 12px; bottom: 12px; }
      .robot-panel { right: 12px; bottom: 76px; }
    }
  </style>
</head>
<body>
  <main class="wrap">
    <section class="card">
      <div class="head">
        <h1>ä¿¡ç”¨å¡ç®¡ç†</h1>
        <a href="./index.html">è¿”å›è¨˜å¸³é¦–é </a>
      </div>
      <p>è¨­å®šä¿¡ç”¨å¡åç¨±èˆ‡ç¹³æ¬¾æ—¥ï¼ˆæ¯æœˆå¹¾è™Ÿï¼‰ã€‚è¨˜å¸³æ™‚å¯é¸æ“‡ä½¿ç”¨å“ªå¼µå¡æ¶ˆè²»ã€‚</p>
    </section>

    <section class="card">
      <div class="grid">
        <input id="cardName" type="text" placeholder="ä¿¡ç”¨å¡åç¨±ï¼ˆå¦‚ï¼šä¸»å¡ï¼‰" />
        <input id="dueDay" type="number" min="1" max="28" placeholder="ç¹³æ¬¾æ—¥ï¼ˆ1-28ï¼‰" value="15" />
        <button id="addBtn" type="button" class="btn-primary">æ–°å¢</button>
      </div>
      <div id="cardList" class="list"></div>
    </section>
  </main>

  <button id="robotBtn" class="robot-btn" title="é–‹å•Ÿå°å¹«æ‰‹">ğŸ¤–</button>
  <aside id="robotPanel" class="robot-panel" aria-hidden="true">
    <p class="tool-title">å°å¹«æ‰‹å·¥å…·ç®±</p>
    <ol class="tool-list">
      <li>è¨ˆç®—æ©Ÿï¼Œç›´æ¥åœ¨é é¢æ—å”åŠ©ä½ åšç°¡å–®è¨ˆç®—</li>
    </ol>
    <section id="toolCalculator" class="tool-body" style="display:block;">
      <div class="calc">
        <input id="calcScreen" class="calc-screen" type="text" value="0" readonly />
        <div class="calc-grid" id="calcGrid">
          <button type="button" data-action="clear">C</button>
          <button type="button" data-action="delete">DEL</button>
          <button type="button" data-value="%">%</button>
          <button type="button" data-value="/">/</button>
          <button type="button" data-value="7">7</button>
          <button type="button" data-value="8">8</button>
          <button type="button" data-value="9">9</button>
          <button type="button" data-value="*">*</button>
          <button type="button" data-value="4">4</button>
          <button type="button" data-value="5">5</button>
          <button type="button" data-value="6">6</button>
          <button type="button" data-value="-">-</button>
          <button type="button" data-value="1">1</button>
          <button type="button" data-value="2">2</button>
          <button type="button" data-value="3">3</button>
          <button type="button" data-value="+">+</button>
          <button type="button" data-value="0">0</button>
          <button type="button" data-value=".">.</button>
          <button type="button" data-action="equal" style="grid-column: span 2;">=</button>
        </div>
      </div>
    </section>
  </aside>

  <script>
    const CREDIT_CARD_STORAGE_KEY = "money-app-credit-cards-v1";
    const LAST_LOCAL_DATA_UPDATE_KEY = "money-app-last-local-data-update-at";
    const DEFAULT_CREDIT_CARDS = [
      { id: "cc-1", name: "ä¸»å¡", dueDay: 15 },
      { id: "cc-2", name: "å‰¯å¡", dueDay: 25 }
    ];

    const cardNameInput = document.getElementById("cardName");
    const dueDayInput = document.getElementById("dueDay");
    const addBtn = document.getElementById("addBtn");
    const cardList = document.getElementById("cardList");

    let creditCards = [];

    function normalizeCreditCards(input) {
      const seed = Array.isArray(input) && input.length ? input : DEFAULT_CREDIT_CARDS;
      const normalized = seed.map((card, index) => {
        if (!card || typeof card.name !== "string") return null;
        const name = card.name.trim();
        if (!name) return null;
        const id = String(card.id || `cc-${Date.now()}-${index}`).trim();
        const dueDay = Math.min(28, Math.max(1, Number(card.dueDay) || 15));
        return { id, name, dueDay };
      }).filter(Boolean);
      return normalized.length ? normalized : DEFAULT_CREDIT_CARDS.slice();
    }

    function loadCreditCards() {
      try {
        const raw = localStorage.getItem(CREDIT_CARD_STORAGE_KEY);
        creditCards = normalizeCreditCards(raw ? JSON.parse(raw) : null);
      } catch {
        creditCards = normalizeCreditCards(null);
      }
      if (!localStorage.getItem(CREDIT_CARD_STORAGE_KEY)) {
        localStorage.setItem(CREDIT_CARD_STORAGE_KEY, JSON.stringify(creditCards));
      }
    }

    function saveCreditCards() {
      localStorage.setItem(LAST_LOCAL_DATA_UPDATE_KEY, new Date().toISOString());
      localStorage.setItem(CREDIT_CARD_STORAGE_KEY, JSON.stringify(creditCards));
    }

    function escapeHtml(text) {
      return String(text || "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#39;");
    }

    function renderCards() {
      cardList.innerHTML = "";
      creditCards.forEach((card) => {
        const row = document.createElement("div");
        row.className = "row";
        row.dataset.id = card.id;
        row.innerHTML = `
          <div>
            <div>${escapeHtml(card.name)}</div>
            <div class="meta">æ¯æœˆ ${card.dueDay} æ—¥ç¹³æ¬¾</div>
          </div>
          <div class="row-actions">
            <button type="button" class="tiny-btn" data-action="delete" data-id="${card.id}">åˆªé™¤</button>
          </div>
        `;
        cardList.appendChild(row);
      });
    }

    function addCard() {
      const name = String(cardNameInput.value || "").trim();
      const dueDay = Math.min(28, Math.max(1, Number(dueDayInput.value) || 15));
      if (!name) {
        alert("è«‹è¼¸å…¥ä¿¡ç”¨å¡åç¨±ã€‚");
        return;
      }
      if (creditCards.some((c) => c.name === name)) {
        alert("å·²å­˜åœ¨åŒåç¨±çš„ä¿¡ç”¨å¡ã€‚");
        return;
      }
      creditCards.push({
        id: `cc-${Date.now()}`,
        name,
        dueDay
      });
      saveCreditCards();
      renderCards();
      cardNameInput.value = "";
      dueDayInput.value = "15";
      alert("å·²æ–°å¢ä¿¡ç”¨å¡ã€‚");
    }

    cardList.addEventListener("click", (event) => {
      const btn = event.target.closest("button");
      if (!btn || btn.dataset.action !== "delete") return;
      const id = btn.dataset.id;
      if (!id) return;
      if (!confirm("ç¢ºå®šè¦åˆªé™¤æ­¤ä¿¡ç”¨å¡å—ï¼Ÿç›¸é—œæ¶ˆè²»ç´€éŒ„çš„ä¿¡ç”¨å¡æ¬„ä½å°‡è¢«æ¸…ç©ºã€‚")) return;
      creditCards = creditCards.filter((c) => c.id !== id);
      saveCreditCards();
      renderCards();
      alert("å·²åˆªé™¤ã€‚");
    });

    addBtn.addEventListener("click", addCard);
    loadCreditCards();
    renderCards();

    (function initRobot() {
      const robotBtn = document.getElementById("robotBtn");
      const robotPanel = document.getElementById("robotPanel");
      const calcScreen = document.getElementById("calcScreen");
      const calcGrid = document.getElementById("calcGrid");
      let calcExpression = "0";
      function safeEval(expr) {
        const n = (expr || "").replace(/%/g, "/100");
        if (!/^[\d+\-*/().\s]+$/.test(n)) return null;
        try {
          const r = Function('"use strict"; return (' + n + ');')();
          return Number.isFinite(r) ? r : null;
        } catch { return null; }
      }
      if (robotBtn && robotPanel) {
        robotBtn.addEventListener("click", () => {
          robotPanel.classList.toggle("show");
          robotPanel.setAttribute("aria-hidden", robotPanel.classList.contains("show") ? "false" : "true");
        });
      }
      if (calcGrid && calcScreen) {
        calcGrid.addEventListener("click", (e) => {
          const btn = e.target;
          if (!(btn instanceof HTMLButtonElement)) return;
          const { value, action } = btn.dataset;
          if (action === "clear") calcExpression = "0";
          else if (action === "delete") calcExpression = calcExpression.length > 1 ? calcExpression.slice(0, -1) : "0";
          else if (action === "equal") { const r = safeEval(calcExpression); calcExpression = r === null ? "éŒ¯èª¤" : String(r); }
          else if (value) calcExpression = (calcExpression === "0" || calcExpression === "éŒ¯èª¤") ? value : calcExpression + value;
          calcScreen.value = calcExpression;
        });
      }
    })();
  </script>
</body>
</html>
